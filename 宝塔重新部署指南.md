# 🚀 Facebook BM 切换器 - 宝塔面板重新部署指南

> 专为技术小白准备的详细步骤指南

## 📋 开始之前

### 您需要准备的信息：
- [ ] 宝塔面板登录地址：`http://您的服务器IP:8888`
- [ ] 宝塔面板用户名和密码
- [ ] 网站域名（如：bmswitcher.com）
- [ ] SSH登录信息（可选，建议使用宝塔面板终端）

## 🎯 第一步：登录宝塔面板

1. 打开浏览器，访问：`http://您的服务器IP:8888`
2. 输入用户名和密码登录
3. 进入宝塔面板首页

## 🛡️ 第二步：备份当前网站（必做！）

1. 点击左侧菜单 `网站`
2. 找到您的 Facebook BM 网站行
3. 点击右侧 `设置`
4. 选择 `备份` 标签
5. 点击 `创建备份` → 等待备份完成
6. ✅ 看到"备份成功"提示

## 🔧 第三步：打开终端

在宝塔面板中：
1. 点击左侧菜单 `终端`
2. 或者点击右上角 `终端` 图标
3. 现在您有一个黑色的命令行窗口

## ⏹️ 第四步：停止当前服务

在终端中输入以下命令（一行一行输入）：

```bash
pm2 stop facebook-bm-switcher
```

如果看到类似这样的输出，说明成功：
```
[PM2] Applying action stopProcessId on app [facebook-bm-switcher](ids: [ 0 ])
[PM2] [facebook-bm-switcher](0) ✓
```

## 📁 第五步：进入网站目录

```bash
cd /www/wwwroot/您的域名
```

⚠️ **注意**：将"您的域名"替换为您的实际域名文件夹名称
例如：`cd /www/wwwroot/bmswitcher.com`

## 🔄 第六步：更新代码

### 方法A：使用 Git 更新（推荐）

如果您的项目是通过 Git 部署的：

```bash
git pull origin main
```

### 方法B：手动上传文件更新

如果您是手动上传的文件：

1. 在宝塔面板中点击 `文件`
2. 进入您的网站目录：`/www/wwwroot/您的域名/`
3. **备份重要文件**：
   - 将 `node_modules` 文件夹重命名为 `node_modules_backup`
   - 将 `.env` 文件（如果有）复制一份
4. **删除旧文件**：
   - 删除除了 `node_modules_backup` 外的所有文件和文件夹
5. **上传新文件**：
   - 上传您的新项目 ZIP 文件
   - 解压到当前目录
6. **恢复备份**：
   - 删除新的 `node_modules` 文件夹
   - 将 `node_modules_backup` 重命名为 `node_modules`

## 📦 第七步：安装/更新依赖

在终端中执行：

```bash
pnpm install
```

如果出现权限错误，尝试：
```bash
sudo pnpm install
```

等待安装完成，可能需要2-5分钟。

## 🔨 第八步：重新构建项目

```bash
pnpm build
```

这个过程可能需要1-3分钟，等待看到 "✓ Compiled successfully" 字样。

## 🚀 第九步：重启服务

```bash
pm2 restart facebook-bm-switcher
```

看到类似输出说明成功：
```
[PM2] Applying action restartProcessId on app [facebook-bm-switcher](ids: [ 0 ])
[PM2] [facebook-bm-switcher](0) ✓
```

## ✅ 第十步：验证部署

### 1. 检查服务状态
```bash
pm2 status
```

应该看到 `facebook-bm-switcher` 状态为 `online`：
```
┌─────┬────────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┐
│ id  │ name                   │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │
├─────┼────────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┤
│ 0   │ facebook-bm-switcher   │ default     │ 1.0.0   │ fork    │ 12345    │ 2s     │ 1    │ online    │ 0%       │ 50.2mb   │ www      │
└─────┴────────────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┘
```

### 2. 检查应用日志
```bash
pm2 logs facebook-bm-switcher --lines 20
```

正常情况下应该看到：
```
0|facebook-bm-switcher  | ▲ Next.js 14.0.4
0|facebook-bm-switcher  | - Local:        http://localhost:3000
0|facebook-bm-switcher  | ✓ Ready in 2.3s
```

### 3. 访问网站
在浏览器中访问您的域名，检查：
- [ ] 网站可以正常打开
- [ ] 页面内容是最新的
- [ ] 没有错误提示
- [ ] 所有功能都正常工作

## 🆘 常见问题及解决方法

### 问题1：pm2 命令不存在
**解决方法**：
```bash
npm install -g pm2
```

### 问题2：权限被拒绝
**解决方法**：
```bash
sudo chown -R www:www /www/wwwroot/您的域名
```

### 问题3：端口被占用
**解决方法**：
```bash
lsof -i :3000
kill -9 进程ID
```

### 问题4：内存不足
**解决方法**：
```bash
free -h
# 如果内存不足，重启服务器或清理内存
```

### 问题5：网站显示 502 错误
**检查步骤**：
1. 确认 PM2 服务正在运行：`pm2 status`
2. 查看错误日志：`pm2 logs facebook-bm-switcher`
3. 检查端口监听：`netstat -tlnp | grep :3000`

## 📞 需要帮助？

如果遇到问题：

1. **查看详细日志**：
   ```bash
   pm2 logs facebook-bm-switcher --lines 50
   ```

2. **重启整个服务**：
   ```bash
   pm2 restart all
   ```

3. **完全重启**（最后手段）：
   ```bash
   pm2 delete facebook-bm-switcher
   pm2 start ecosystem.config.js
   ```

## 🎉 完成！

如果一切正常，您的 Facebook BM 切换器网站已经成功更新部署！

**最后检查清单**：
- [ ] 网站可以正常访问
- [ ] 页面显示最新内容
- [ ] 所有链接都能正常工作
- [ ] 没有错误提示
- [ ] PM2 状态显示 online

---

**💡 小贴士**：
- 每次更新前都要备份
- 定期查看 PM2 日志，及时发现问题
- 如果不确定，先在测试环境试验
- 保存好这个部署指南，下次更新时使用
